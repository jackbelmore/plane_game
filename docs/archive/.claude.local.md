# Local Development Notes (Not Checked In)

## Current Session Work (2026-02-05)

### What We Fixed
1. **Asset path bug** - Removed `#Scene0` selector (was breaking all tree loading)
2. **System ordering bug** - Moved LOD to PostUpdate (trees weren't visible to LOD in Update)
3. **Missing lighting** - Added AmbientLight (trees were rendering black)
4. **Ground holes** - Increased LOAD_RADIUS from 5 to 8km (provides 3km cushion)
5. **NaN crash protection** - Added safety check in check_ground_collision()
6. **Entity reduction** - Reduced trees from 50â†’10 per chunk for performance

### Current Issue (In Progress)
- SceneRoot + .glb loading completely broken in Bevy 0.15
- Workaround: Currently using Cuboid geometry as test meshes (green cubes)
- Next: Need to either:
  - Load Mesh directly from glTF (more complex)
  - Or find why .glb files don't spawn scene children

### Reproduction
```bash
# Game currently shows green test cubes instead of trees
cd /c/Users/Box/plane_game
cargo build --release
cp -r assets target/release/
target/release/plane_game.exe
```

## Chat Continuity
- **Previous chats:** Multiple sessions on this project (game design, phase 2 implementation, etc.)
- **Key issue discovered:** All previous chats may have been working around invisible assets
- **Critical realization:** The problem wasn't missing files - it was invisible rendering

## Gemini Integration Notes
- Gemini correctly identified: lack of ambient light + coordinate mismatch
- Gemini's fixes: lighting + chunk buffer + tree height corrections
- Status: Waiting for visual confirmation that fixes work

## Performance Notes
- Current entity count: ~360-500 (trees + UI + terrain meshes)
- Build time: ~1m 50s (release mode)
- Game runs at 60+ FPS with visual lag during chunk load (expected)

## To-Do for Next Chat
- [ ] Confirm ambient lighting + chunk buffer fixes make trees visible
- [ ] Replace Cuboid test meshes with actual .glb loading
- [ ] Test if wall.glb renders (currently testing asset type)
- [ ] Implement proper mesh-based tree loading (avoid SceneRoot)
- [ ] Add ground texture/grid for speed feedback
- [ ] Profile performance and optimize if needed

## Environment Info
- OS: Windows 11 Enterprise
- GPU: RTX 3080 Ti
- CPU: Ryzen 7 5800X
- Rust version: (check with `rustc --version`)
- Bevy: 0.15
- Avian3D: Latest (physics plugin)

## Useful Grep Patterns
```bash
# Find all tree spawning code
grep -n "spawn.*[Tt]ree\|Tree\|tree_model" src/main.rs

# Find all asset paths
grep -n "fantasy_town\|asset_server.load" src/main.rs

# Find LOD system
grep -n "LOD\|Visibility" src/main.rs

# Find chunk constants
grep -n "LOAD_RADIUS\|UNLOAD_RADIUS\|CHUNK_SIZE\|TREES_PER" src/main.rs
```

---

**Local only** - not part of team documentation